var ee=Object.defineProperty;var te=(m,e,t)=>e in m?ee(m,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):m[e]=t;var n=(m,e,t)=>(te(m,typeof e!="symbol"?e+"":e,t),t);import{a as u,j as l}from"./index-5d5c5b17.js";import{r as y}from"./vendor-08663a87.js";import"./ui-529afc54.js";const T=class T{constructor(){n(this,"strategies",new Map);n(this,"patterns",new Map);n(this,"errorHistory",[]);n(this,"metrics",{totalErrors:0,errorsByType:{},errorsByComponent:{},recoverySuccessRate:0,patterns:{}});n(this,"maxHistorySize",1e3);n(this,"listeners",new Set);n(this,"sessionId",this.generateSessionId());this.initializeDefaultStrategies(),this.initializeDefaultPatterns(),this.setupGlobalErrorHandlers()}static getInstance(){return T.instance||(T.instance=new T),T.instance}generateSessionId(){return Math.random().toString(36).substring(2)+Date.now().toString(36)}initializeDefaultStrategies(){this.registerStrategy({name:"storage-recovery",priority:1,canRecover:(e,t)=>e.message.includes("localStorage")||e.message.includes("sessionStorage")||e.message.includes("storage"),recover:async(e,t)=>{try{return typeof Storage<"u"&&(localStorage.clear(),sessionStorage.clear()),typeof Storage<"u"&&Object.entries({theme:"light",language:"vi",initialized:!0}).forEach(([s,a])=>{try{localStorage.setItem(s,JSON.stringify(a))}catch(i){console.warn(`Failed to restore ${s}:`,i)}}),console.log("Storage recovery completed"),!0}catch(r){return console.error("Storage recovery failed:",r),!1}}}),this.registerStrategy({name:"component-reload",priority:2,canRecover:(e,t)=>t.component!==void 0&&!e.message.includes("Maximum update depth exceeded"),recover:async(e,t)=>{try{if(t.component){console.log(`Attempting to reload component: ${t.component}`);const r=new CustomEvent("force-component-reload",{detail:{component:t.component,errorId:t.id}});return window.dispatchEvent(r),!0}return!1}catch(r){return console.error("Component reload failed:",r),!1}}}),this.registerStrategy({name:"network-recovery",priority:3,canRecover:(e,t)=>{var r;return e.message.includes("fetch")||e.message.includes("network")||e.message.includes("Failed to fetch")||((r=t.action)==null?void 0:r.includes("api-"))},recover:async(e,t)=>{var r;try{return navigator.onLine||await this.waitForNetwork(),t.action&&((r=t.metadata)!=null&&r.retryFunction)?(console.log(`Retrying action: ${t.action}`),await t.metadata.retryFunction(),!0):!1}catch(s){return console.error("Network recovery failed:",s),!1}}}),this.registerStrategy({name:"auth-recovery",priority:4,canRecover:(e,t)=>{var r;return e.message.includes("unauthorized")||e.message.includes("403")||e.message.includes("401")||((r=t.action)==null?void 0:r.includes("auth-"))},recover:async(e,t)=>{try{if(this.getStorageItem("refresh_token")){console.log("Attempting auth recovery with refresh token");const s=new CustomEvent("auth-refresh-required",{detail:{errorId:t.id}});return window.dispatchEvent(s),!0}return console.log("No refresh token available, redirecting to login"),window.location.href="/salebds/login",!0}catch(r){return console.error("Auth recovery failed:",r),!1}}}),this.registerStrategy({name:"memory-recovery",priority:5,canRecover:(e,t)=>e.message.includes("out of memory")||e.message.includes("Maximum call stack")||e.name==="RangeError",recover:async(e,t)=>{try{if("gc"in window&&typeof window.gc=="function"&&window.gc(),"caches"in window){const s=await caches.keys();for(const a of s)(a.includes("api-cache")||a.includes("temp-"))&&await caches.delete(a)}const r=new CustomEvent("clear-query-cache",{detail:{errorId:t.id}});return window.dispatchEvent(r),console.log("Memory recovery completed"),!0}catch(r){return console.error("Memory recovery failed:",r),!1}}})}initializeDefaultPatterns(){this.registerPattern({name:"storage-error",pattern:/localStorage|sessionStorage|storage/i,severity:"medium",recoverable:!0,strategies:["storage-recovery"]}),this.registerPattern({name:"network-error",pattern:/fetch|network|Failed to fetch|ERR_NETWORK/i,severity:"medium",recoverable:!0,strategies:["network-recovery"]}),this.registerPattern({name:"auth-error",pattern:/unauthorized|403|401|forbidden/i,severity:"high",recoverable:!0,strategies:["auth-recovery"]}),this.registerPattern({name:"memory-error",pattern:/out of memory|Maximum call stack|RangeError/i,severity:"critical",recoverable:!0,strategies:["memory-recovery"]}),this.registerPattern({name:"component-error",pattern:/Cannot read prop|undefined is not a function|null is not an object/i,severity:"medium",recoverable:!0,strategies:["component-reload"]}),this.registerPattern({name:"critical-system-error",pattern:e=>e.name==="ChunkLoadError"||e.message.includes("Loading chunk"),severity:"critical",recoverable:!0,strategies:["storage-recovery","component-reload"],metadata:{requiresReload:!0}})}setupGlobalErrorHandlers(){window.addEventListener("error",e=>{const t=this.createErrorContext(e.error||new Error(e.message),{filename:e.filename,lineno:e.lineno,colno:e.colno});this.handleError(e.error||new Error(e.message),t)}),window.addEventListener("unhandledrejection",e=>{const t=e.reason instanceof Error?e.reason:new Error(String(e.reason)),r=this.createErrorContext(t,{type:"unhandled-promise"});this.handleError(t,r),e.preventDefault()}),window.addEventListener("react-error-boundary",e=>{const{error:t,errorInfo:r}=e.detail,s=this.createErrorContext(t,{componentStack:r.componentStack,type:"react-boundary"});this.handleError(t,s)})}createErrorContext(e,t={}){return{id:`error-${Date.now()}-${Math.random().toString(36).substring(2)}`,timestamp:Date.now(),sessionId:this.sessionId,url:window.location.href,userAgent:navigator.userAgent,stack:e.stack,...t}}waitForNetwork(e=3e4){return new Promise((t,r)=>{if(navigator.onLine){t();return}const s=setTimeout(()=>{window.removeEventListener("online",a),r(new Error("Network timeout"))},e),a=()=>{clearTimeout(s),window.removeEventListener("online",a),t()};window.addEventListener("online",a)})}getStorageItem(e){try{return localStorage.getItem(e)||sessionStorage.getItem(e)}catch{return null}}registerStrategy(e){this.strategies.set(e.name,e),console.log(`Registered recovery strategy: ${e.name}`)}registerPattern(e){this.patterns.set(e.name,e),console.log(`Registered error pattern: ${e.name}`)}async handleError(e,t){console.error("Error handled by recovery system:",e,t),this.updateMetrics(e,t),this.errorHistory.push(t),this.errorHistory.length>this.maxHistorySize&&this.errorHistory.shift(),this.listeners.forEach(s=>{try{s(t)}catch(a){console.error("Error listener failed:",a)}});const r=this.findMatchingPatterns(e);console.log("Matched patterns:",r.map(s=>s.name));for(const s of r)if(s.recoverable)for(const a of s.strategies){const i=this.strategies.get(a);if(i&&i.canRecover(e,t))try{if(console.log(`Attempting recovery with strategy: ${a}`),await i.recover(e,t))return console.log(`Recovery successful with strategy: ${a}`),this.updateRecoveryMetrics(!0),!0}catch(c){console.error(`Recovery strategy ${a} failed:`,c)}}return this.updateRecoveryMetrics(!1),!1}findMatchingPatterns(e){const t=[];for(const r of this.patterns.values()){let s=!1;r.pattern instanceof RegExp?s=r.pattern.test(e.message)||r.pattern.test(e.name)||e.stack&&r.pattern.test(e.stack):typeof r.pattern=="function"&&(s=r.pattern(e)),s&&(t.push(r),this.metrics.patterns[r.name]=(this.metrics.patterns[r.name]||0)+1)}return t.sort((r,s)=>{const a={critical:4,high:3,medium:2,low:1};return a[s.severity]-a[r.severity]})}updateMetrics(e,t){this.metrics.totalErrors++,this.metrics.errorsByType[e.name]=(this.metrics.errorsByType[e.name]||0)+1,t.component&&(this.metrics.errorsByComponent[t.component]=(this.metrics.errorsByComponent[t.component]||0)+1),this.metrics.lastError=t}updateRecoveryMetrics(e){this.errorHistory.length>0&&(this.metrics.recoverySuccessRate=e?Math.min(this.metrics.recoverySuccessRate+.1,1):Math.max(this.metrics.recoverySuccessRate-.05,0))}addErrorListener(e){return this.listeners.add(e),()=>this.listeners.delete(e)}getMetrics(){return{...this.metrics}}getErrorHistory(e){return e?this.errorHistory.slice(-e):[...this.errorHistory]}clearHistory(){this.errorHistory=[],console.log("Error history cleared")}async performHealthCheck(){const e={};try{localStorage.setItem("health-check","test"),localStorage.removeItem("health-check"),e.localStorage=!0}catch{e.localStorage=!1}try{await fetch("/salebds/manifest.webmanifest",{method:"HEAD"}),e.network=!0}catch{e.network=!1}if(e.memory=this.metrics.errorsByType.RangeError===void 0,"serviceWorker"in navigator)try{const a=await navigator.serviceWorker.getRegistration("/salebds/");e.serviceWorker=!!a}catch{e.serviceWorker=!1}else e.serviceWorker=!1;const t=Object.values(e).filter(Boolean).length,r=Object.keys(e).length;let s;return t===r?s="healthy":t>=r/2?s="degraded":s="unhealthy",{status:s,checks:e,details:{metrics:this.getMetrics(),recentErrors:this.getErrorHistory(5)}}}exportState(){return{sessionId:this.sessionId,metrics:this.metrics,errorHistory:this.errorHistory,strategies:Array.from(this.strategies.keys()),patterns:Array.from(this.patterns.keys()),timestamp:Date.now()}}importState(e){e.sessionId&&(this.sessionId=e.sessionId),e.metrics&&(this.metrics={...this.metrics,...e.metrics}),e.errorHistory&&(this.errorHistory=e.errorHistory),console.log("System state imported")}};n(T,"instance");let M=T;const w=M.getInstance(),b=class b{constructor(){n(this,"state");n(this,"refreshTimer",null);n(this,"sessionTimer",null);n(this,"listeners",new Set);n(this,"eventListeners",new Set);n(this,"STORAGE_KEYS",{TOKENS:"auth_tokens",USER:"auth_user",SESSION:"auth_session",PREFERENCES:"user_preferences",DEVICE_ID:"device_id"});n(this,"deviceId");n(this,"apiBaseUrl","/api/v1");this.deviceId=this.getOrCreateDeviceId(),this.state={user:null,tokens:null,session:null,isAuthenticated:!1,isLoading:!0,error:null,lastActivity:Date.now(),sessionTimeout:30*60*1e3},this.initializeFromStorage(),this.setupActivityTracking(),this.setupStorageListener()}static getInstance(){return b.instance||(b.instance=new b),b.instance}getOrCreateDeviceId(){try{let e=localStorage.getItem(this.STORAGE_KEYS.DEVICE_ID);return e||(e=this.generateDeviceId(),localStorage.setItem(this.STORAGE_KEYS.DEVICE_ID,e)),e}catch{return this.generateDeviceId()}}generateDeviceId(){const e=document.createElement("canvas"),t=e.getContext("2d");t==null||t.fillText("Device fingerprint",10,10);const r=e.toDataURL();return btoa(navigator.userAgent+navigator.language+screen.width+"x"+screen.height+new Date().getTimezoneOffset()+r).replace(/[^a-zA-Z0-9]/g,"").substring(0,32)}async initializeFromStorage(){try{this.setState({isLoading:!0});const e=this.getStorageItem(this.STORAGE_KEYS.TOKENS),t=this.getStorageItem(this.STORAGE_KEYS.USER),r=this.getStorageItem(this.STORAGE_KEYS.SESSION);if(e&&t){const s=JSON.parse(e),a=JSON.parse(t),i=r?JSON.parse(r):null;s.expiresAt>Date.now()?(this.setState({user:a,tokens:s,session:i,isAuthenticated:!0,error:null}),this.scheduleTokenRefresh(s.expiresAt),this.startSessionTimer(),await this.verifySession()):s.refreshToken?await this.refreshAccessToken():await this.logout()}}catch(e){console.error("Auth initialization error:",e),w.handleError(e,{id:"auth-init-error",timestamp:Date.now(),sessionId:this.deviceId,url:window.location.href,userAgent:navigator.userAgent,component:"AuthenticationSystem",action:"initialize"}),await this.logout()}finally{this.setState({isLoading:!1})}}setupActivityTracking(){const e=["mousedown","mousemove","keypress","scroll","touchstart"],t=()=>{this.setState({lastActivity:Date.now()})};e.forEach(r=>{document.addEventListener(r,t,!0)}),setInterval(()=>{Date.now()-this.state.lastActivity>this.state.sessionTimeout&&this.handleSessionTimeout()},6e4)}setupStorageListener(){window.addEventListener("storage",e=>{e.key===this.STORAGE_KEYS.TOKENS&&e.newValue===null&&this.handleLogoutFromOtherTab()})}async handleSessionTimeout(){console.log("Session timeout detected"),this.emitEvent({type:"session-expired",timestamp:Date.now(),metadata:{reason:"inactivity"}}),await this.logout()}async handleLogoutFromOtherTab(){console.log("Logout from other tab detected"),this.setState({user:null,tokens:null,session:null,isAuthenticated:!1,error:null}),this.clearTimers()}setState(e){this.state={...this.state,...e},this.notifyListeners()}notifyListeners(){this.listeners.forEach(e=>{try{e(this.state)}catch(t){console.error("Auth listener error:",t)}})}emitEvent(e){this.eventListeners.forEach(t=>{try{t(e)}catch(r){console.error("Auth event listener error:",r)}})}getStorageItem(e){try{return localStorage.getItem(e)||sessionStorage.getItem(e)}catch{return null}}setStorageItem(e,t,r=!0){try{r&&typeof Storage<"u"?localStorage.setItem(e,t):typeof Storage<"u"&&sessionStorage.setItem(e,t)}catch(s){console.warn(`Failed to store ${e}:`,s)}}removeStorageItem(e){try{localStorage.removeItem(e),sessionStorage.removeItem(e)}catch(t){console.warn(`Failed to remove ${e}:`,t)}}scheduleTokenRefresh(e){this.clearRefreshTimer();const t=e-Date.now()-5*60*1e3;t>0?this.refreshTimer=setTimeout(async()=>{await this.refreshAccessToken()},t):setTimeout(async()=>{await this.refreshAccessToken()},1e3)}startSessionTimer(){this.clearSessionTimer(),this.sessionTimer=setTimeout(()=>{this.handleSessionTimeout()},this.state.sessionTimeout)}clearTimers(){this.clearRefreshTimer(),this.clearSessionTimer()}clearRefreshTimer(){this.refreshTimer&&(clearTimeout(this.refreshTimer),this.refreshTimer=null)}clearSessionTimer(){this.sessionTimer&&(clearTimeout(this.sessionTimer),this.sessionTimer=null)}async login(e){try{this.setState({isLoading:!0,error:null});const t=await fetch(`${this.apiBaseUrl}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json","X-Device-ID":this.deviceId},body:JSON.stringify({...e,deviceInfo:{id:this.deviceId,userAgent:navigator.userAgent,platform:navigator.platform,language:navigator.language}})});if(!t.ok)throw new Error(await t.text());const r=await t.json(),{user:s,tokens:a,session:i}=r;return this.setStorageItem(this.STORAGE_KEYS.TOKENS,JSON.stringify(a),e.rememberMe),this.setStorageItem(this.STORAGE_KEYS.USER,JSON.stringify(s),e.rememberMe),this.setStorageItem(this.STORAGE_KEYS.SESSION,JSON.stringify(i),e.rememberMe),this.setState({user:s,tokens:a,session:i,isAuthenticated:!0,isLoading:!1,error:null}),this.scheduleTokenRefresh(a.expiresAt),this.startSessionTimer(),this.emitEvent({type:"login",user:s,timestamp:Date.now()}),s}catch(t){throw this.setState({isLoading:!1,error:t.message}),w.handleError(t,{id:"auth-login-error",timestamp:Date.now(),sessionId:this.deviceId,url:window.location.href,userAgent:navigator.userAgent,component:"AuthenticationSystem",action:"login"}),t}}async register(e){try{this.setState({isLoading:!0,error:null});const t=await fetch(`${this.apiBaseUrl}/auth/register`,{method:"POST",headers:{"Content-Type":"application/json","X-Device-ID":this.deviceId},body:JSON.stringify({...e,deviceInfo:{id:this.deviceId,userAgent:navigator.userAgent,platform:navigator.platform,language:navigator.language}})});if(!t.ok)throw new Error(await t.text());const r=await t.json(),{user:s,tokens:a,session:i}=r;return this.setStorageItem(this.STORAGE_KEYS.TOKENS,JSON.stringify(a),!0),this.setStorageItem(this.STORAGE_KEYS.USER,JSON.stringify(s),!0),this.setStorageItem(this.STORAGE_KEYS.SESSION,JSON.stringify(i),!0),this.setState({user:s,tokens:a,session:i,isAuthenticated:!0,isLoading:!1,error:null}),this.scheduleTokenRefresh(a.expiresAt),this.startSessionTimer(),this.emitEvent({type:"login",user:s,timestamp:Date.now(),metadata:{source:"registration"}}),s}catch(t){throw this.setState({isLoading:!1,error:t.message}),t}}async logout(){try{const e=this.state.tokens;if(e)try{await fetch(`${this.apiBaseUrl}/auth/logout`,{method:"POST",headers:{Authorization:`${e.tokenType} ${e.accessToken}`,"X-Device-ID":this.deviceId}})}catch(t){console.warn("Logout API call failed:",t)}Object.values(this.STORAGE_KEYS).forEach(t=>{this.removeStorageItem(t)}),this.clearTimers(),this.setState({user:null,tokens:null,session:null,isAuthenticated:!1,isLoading:!1,error:null}),this.emitEvent({type:"logout",timestamp:Date.now()})}catch(e){console.error("Logout error:",e)}}async refreshAccessToken(){try{const e=this.state.tokens;if(!(e!=null&&e.refreshToken))throw new Error("No refresh token available");const t=await fetch(`${this.apiBaseUrl}/auth/refresh`,{method:"POST",headers:{"Content-Type":"application/json","X-Device-ID":this.deviceId},body:JSON.stringify({refreshToken:e.refreshToken})});if(!t.ok)throw new Error("Token refresh failed");const s=(await t.json()).tokens,a=!!this.getStorageItem(this.STORAGE_KEYS.TOKENS);return this.setStorageItem(this.STORAGE_KEYS.TOKENS,JSON.stringify(s),a),this.setState({tokens:s}),this.scheduleTokenRefresh(s.expiresAt),this.emitEvent({type:"refresh",timestamp:Date.now()}),!0}catch(e){return console.error("Token refresh failed:",e),await this.logout(),!1}}async verifySession(){try{const e=this.state.tokens;if(!e)return!1;const t=await fetch(`${this.apiBaseUrl}/auth/verify`,{method:"GET",headers:{Authorization:`${e.tokenType} ${e.accessToken}`,"X-Device-ID":this.deviceId}});if(!t.ok)throw new Error("Session verification failed");const r=await t.json();return r.user&&(this.setStorageItem(this.STORAGE_KEYS.USER,JSON.stringify(r.user),!0),this.setState({user:r.user})),!0}catch(e){return console.error("Session verification failed:",e),await this.logout(),!1}}async changePassword(e,t){try{const r=this.state.tokens;if(!r)throw new Error("Not authenticated");const s=await fetch(`${this.apiBaseUrl}/auth/change-password`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`${r.tokenType} ${r.accessToken}`,"X-Device-ID":this.deviceId},body:JSON.stringify({currentPassword:e,newPassword:t})});if(!s.ok)throw new Error(await s.text());this.emitEvent({type:"password-changed",timestamp:Date.now(),user:this.state.user||void 0})}catch(r){throw console.error("Change password error:",r),r}}async requestPasswordReset(e){try{const t=await fetch(`${this.apiBaseUrl}/auth/reset-password`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e})});if(!t.ok)throw new Error(await t.text())}catch(t){throw console.error("Password reset request error:",t),t}}async resetPassword(e,t){try{const r=await fetch(`${this.apiBaseUrl}/auth/reset-password/confirm`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:e,newPassword:t})});if(!r.ok)throw new Error(await r.text())}catch(r){throw console.error("Password reset error:",r),r}}async updateProfile(e){try{const t=this.state.tokens;if(!t)throw new Error("Not authenticated");const r=await fetch(`${this.apiBaseUrl}/auth/profile`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`${t.tokenType} ${t.accessToken}`},body:JSON.stringify(e)});if(!r.ok)throw new Error(await r.text());const s=await r.json();return this.setStorageItem(this.STORAGE_KEYS.USER,JSON.stringify(s),!0),this.setState({user:s}),s}catch(t){throw console.error("Profile update error:",t),t}}addStateListener(e){return this.listeners.add(e),()=>this.listeners.delete(e)}addEventListener(e){return this.eventListeners.add(e),()=>this.eventListeners.delete(e)}getState(){return{...this.state}}getUser(){return this.state.user}getTokens(){return this.state.tokens}isAuthenticated(){return this.state.isAuthenticated}isLoading(){return this.state.isLoading}getError(){return this.state.error}hasPermission(e){var t;return((t=this.state.user)==null?void 0:t.permissions.includes(e))??!1}hasRole(e){return this.state.user?(Array.isArray(e)?e:[e]).includes(this.state.user.role):!1}getAuthHeader(){const e=this.state.tokens;return e?`${e.tokenType} ${e.accessToken}`:null}async makeAuthenticatedRequest(e,t={}){const r=this.getAuthHeader();if(!r)throw new Error("Not authenticated");const s=await fetch(e,{...t,headers:{...t.headers,Authorization:r,"X-Device-ID":this.deviceId}});if(s.status===401&&await this.refreshAccessToken()){const i=this.getAuthHeader();return fetch(e,{...t,headers:{...t.headers,Authorization:i,"X-Device-ID":this.deviceId}})}return s}exportAuthState(){return{state:this.state,deviceId:this.deviceId,storageContents:{tokens:this.getStorageItem(this.STORAGE_KEYS.TOKENS),user:this.getStorageItem(this.STORAGE_KEYS.USER),session:this.getStorageItem(this.STORAGE_KEYS.SESSION)},timestamp:Date.now()}}clearAuthData(){Object.values(this.STORAGE_KEYS).forEach(e=>{this.removeStorageItem(e)}),this.setState({user:null,tokens:null,session:null,isAuthenticated:!1,error:null}),console.log("Auth data cleared")}};n(b,"instance");let $=b;const R=$.getInstance(),A=class A{constructor(){n(this,"state");n(this,"listeners",new Set);n(this,"middlewares",[]);n(this,"persistenceConfig",null);n(this,"persistenceTimer",null);n(this,"actionHistory",[]);n(this,"maxHistorySize",1e3);n(this,"devMode",!1);this.state=this.createInitialState(),this.setupDefaultMiddlewares(),this.setupStorageListener()}static getInstance(){return A.instance||(A.instance=new A),A.instance}createInitialState(){return{auth:{isAuthenticated:!1,user:null,tokens:null,loading:!1,error:null,sessionExpiry:null},ui:{theme:"light",language:"vi",sidebarCollapsed:!1,modals:{},loading:{},errors:{},notifications:[],currentPage:"/",breadcrumbs:[]},data:{customers:this.createEntityState(),properties:this.createEntityState(),projects:this.createEntityState(),interactions:this.createEntityState(),reports:this.createEntityState(),analytics:{metrics:{},charts:{},filters:{},dateRange:{start:"",end:""},lastUpdated:0},lastUpdated:{},syncStatus:{}},cache:{queries:{},invalidationRules:[],totalSize:0,maxSize:50*1024*1024,lastCleanup:Date.now()},settings:{preferences:{theme:"light",language:"vi",timezone:"Asia/Ho_Chi_Minh",dateFormat:"dd/MM/yyyy",numberFormat:"vi-VN",notifications:{push:!0,email:!0,sms:!1,quietHours:{enabled:!1,start:"22:00",end:"07:00"}},layout:{density:"comfortable",sidebarWidth:280,showAvatars:!0}},appConfig:{apiUrl:"/api/v1",apiVersion:"1.0.0",environment:"production",features:{realTimeSync:!0,offlineMode:!0,advancedAnalytics:!0,aiAssistant:!1},limits:{maxFileSize:10*1024*1024,maxCustomers:1e4,maxProperties:5e4},integrations:{google:{enabled:!1,apiKey:""},facebook:{enabled:!1,appId:""},zalo:{enabled:!1,appId:""}}},featureFlags:{newDashboard:!1,betaFeatures:!1,debugMode:this.devMode},experiments:{}},navigation:{currentRoute:"/",previousRoute:"",params:{},query:{},history:[],canGoBack:!1,canGoForward:!1},notifications:{items:[],unreadCount:0,settings:{enabled:!0,types:{system:!0,user:!0,marketing:!1},quietHours:{enabled:!1,start:"22:00",end:"07:00"},delivery:{push:!0,email:!0,sms:!1}},subscriptions:[]}}}createEntityState(){return{ids:[],entities:{},loading:!1,error:null,lastFetch:null,hasMore:!0,totalCount:0}}setupDefaultMiddlewares(){this.addMiddleware({name:"logger",before:(e,t)=>(this.devMode&&(console.group(`ðŸ”„ ${e.type}`),console.log("Action:",e),console.log("Current State:",t)),e),after:(e,t,r)=>{this.devMode&&(console.log("New State:",r),console.groupEnd())},error:(e,t,r)=>{console.error(`âŒ Error in action ${t.type}:`,e)}}),this.addMiddleware({name:"persistence",after:(e,t,r)=>{this.persistenceConfig&&this.schedulePersistence()}}),this.addMiddleware({name:"errorRecovery",error:(e,t,r)=>{w.handleError(e,{id:`state-error-${Date.now()}`,timestamp:Date.now(),sessionId:"state-management",url:window.location.href,userAgent:navigator.userAgent,component:"StateManagementSystem",action:t.type,metadata:{action:t,state:r}})}}),this.addMiddleware({name:"validation",before:(e,t)=>{if(!e.type)throw new Error("Action must have a type property");return e}}),this.addMiddleware({name:"analytics",after:(e,t,r)=>{(e.type.startsWith("UI_")||e.type.startsWith("NAVIGATION_"))&&this.trackEvent("state_change",{action:e.type,timestamp:Date.now()})}})}setupStorageListener(){window.addEventListener("storage",e=>{var t;e.key===((t=this.persistenceConfig)==null?void 0:t.key)&&this.handleExternalStateChange(e.newValue)})}handleExternalStateChange(e){if(e)try{const t=JSON.parse(e);this.dispatch({type:"STATE_REHYDRATE",payload:t})}catch(t){console.error("Failed to parse external state:",t)}}schedulePersistence(){var t;this.persistenceTimer&&clearTimeout(this.persistenceTimer);const e=((t=this.persistenceConfig)==null?void 0:t.debounceMs)||1e3;this.persistenceTimer=setTimeout(()=>{this.persistState()},e)}async persistState(){if(this.persistenceConfig)try{const{key:e,storage:t,whitelist:r,blacklist:s,transforms:a,maxSize:i}=this.persistenceConfig;let c={...this.state};if(r){const o={};r.forEach(g=>{g in this.state&&(o[g]=this.state[g])}),c=o}else s&&s.forEach(o=>{delete c[o]});a&&Object.entries(a).forEach(([o,g])=>{o in c&&(c[o]=g.serialize(c[o]))});const d=JSON.stringify(c);if(i&&d.length>i){console.warn("State size exceeds maximum, skipping persistence");return}switch(t){case"localStorage":localStorage.setItem(e,d);break;case"sessionStorage":sessionStorage.setItem(e,d);break;case"indexedDB":await this.storeInIndexedDB(e,c);break}this.devMode&&console.log("ðŸ’¾ State persisted:",c)}catch(e){console.error("State persistence failed:",e)}}async storeInIndexedDB(e,t){return new Promise((r,s)=>{const a=indexedDB.open("StateDB",1);a.onerror=()=>s(a.error),a.onsuccess=()=>{const o=a.result.transaction(["state"],"readwrite").objectStore("state").put({id:e,data:t,timestamp:Date.now()});o.onsuccess=()=>r(),o.onerror=()=>s(o.error)},a.onupgradeneeded=()=>{const i=a.result;i.objectStoreNames.contains("state")||i.createObjectStore("state",{keyPath:"id"})}})}async loadPersistedState(){if(!this.persistenceConfig)return null;try{const{key:e,storage:t,transforms:r}=this.persistenceConfig;let s=null;switch(t){case"localStorage":s=localStorage.getItem(e);break;case"sessionStorage":s=sessionStorage.getItem(e);break;case"indexedDB":return await this.loadFromIndexedDB(e)}if(!s)return null;let a=JSON.parse(s);return r&&Object.entries(r).forEach(([i,c])=>{i in a&&(a[i]=c.deserialize(a[i]))}),a}catch(e){return console.error("Failed to load persisted state:",e),null}}async loadFromIndexedDB(e){return new Promise((t,r)=>{const s=indexedDB.open("StateDB",1);s.onerror=()=>r(s.error),s.onsuccess=()=>{const d=s.result.transaction(["state"],"readonly").objectStore("state").get(e);d.onsuccess=()=>{const o=d.result;t(o?o.data:null)},d.onerror=()=>r(d.error)}})}trackEvent(e,t){this.devMode&&console.log("ðŸ“Š Analytics event:",e,t)}dispatch(e){try{this.actionHistory.push({action:e,timestamp:Date.now()}),this.actionHistory.length>this.maxHistorySize&&this.actionHistory.shift();let t=e;for(const a of this.middlewares)if(a.before){const i=a.before(t,this.state);if(i===null)return;t=i}if(t.type==="STATE_BATCH"){t.payload.forEach(a=>{this.dispatch(a)});return}const r=this.state,s=this.reducer(this.state,t);this.state=s;for(const a of this.middlewares)a.after&&a.after(t,r,s);this.notifyListeners()}catch(t){for(const r of this.middlewares)r.error&&r.error(t,e,this.state);throw console.error("State dispatch error:",t),t}}reducer(e,t){switch(t.type){case"AUTH_SET_USER":return{...e,auth:{...e.auth,user:t.payload,isAuthenticated:!!t.payload}};case"AUTH_SET_LOADING":return{...e,auth:{...e.auth,loading:t.payload}};case"AUTH_SET_ERROR":return{...e,auth:{...e.auth,error:t.payload}};case"AUTH_LOGOUT":return{...e,auth:{isAuthenticated:!1,user:null,tokens:null,loading:!1,error:null,sessionExpiry:null}};case"UI_SET_THEME":return{...e,ui:{...e.ui,theme:t.payload}};case"UI_SET_LANGUAGE":return{...e,ui:{...e.ui,language:t.payload}};case"UI_TOGGLE_SIDEBAR":return{...e,ui:{...e.ui,sidebarCollapsed:!e.ui.sidebarCollapsed}};case"UI_SET_MODAL":return{...e,ui:{...e.ui,modals:{...e.ui.modals,[t.payload.id]:t.payload.open}}};case"UI_SET_LOADING":return{...e,ui:{...e.ui,loading:{...e.ui.loading,[t.payload.key]:t.payload.loading}}};case"UI_SET_ERROR":return{...e,ui:{...e.ui,errors:{...e.ui.errors,[t.payload.key]:t.payload.error}}};case"UI_ADD_NOTIFICATION":return{...e,ui:{...e.ui,notifications:[...e.ui.notifications,t.payload]}};case"UI_REMOVE_NOTIFICATION":return{...e,ui:{...e.ui,notifications:e.ui.notifications.filter(g=>g.id!==t.payload)}};case"UI_SET_PAGE":return{...e,ui:{...e.ui,currentPage:t.payload}};case"UI_SET_BREADCRUMBS":return{...e,ui:{...e.ui,breadcrumbs:t.payload}};case"DATA_SET_ENTITIES":return{...e,data:{...e.data,[t.payload.key]:t.payload.data,lastUpdated:{...e.data.lastUpdated,[t.payload.key]:Date.now()}}};case"DATA_ADD_ENTITY":const r=e.data[t.payload.key];return{...e,data:{...e.data,[t.payload.key]:{...r,ids:[...r.ids,t.payload.entity.id],entities:{...r.entities,[t.payload.entity.id]:t.payload.entity}}}};case"DATA_UPDATE_ENTITY":const s=e.data[t.payload.key];return{...e,data:{...e.data,[t.payload.key]:{...s,entities:{...s.entities,[t.payload.id]:{...s.entities[t.payload.id],...t.payload.updates}}}}};case"DATA_REMOVE_ENTITY":const a=e.data[t.payload.key],{[t.payload.id]:i,...c}=a.entities;return{...e,data:{...e.data,[t.payload.key]:{...a,ids:a.ids.filter(g=>g!==t.payload.id),entities:c}}};case"CACHE_SET_QUERY":return{...e,cache:{...e.cache,queries:{...e.cache.queries,[t.payload.id]:t.payload},totalSize:e.cache.totalSize+t.payload.size}};case"CACHE_INVALIDATE_QUERY":const{[t.payload]:d,...o}=e.cache.queries;return{...e,cache:{...e.cache,queries:o,totalSize:e.cache.totalSize-((d==null?void 0:d.size)||0)}};case"SETTINGS_UPDATE_PREFERENCES":return{...e,settings:{...e.settings,preferences:{...e.settings.preferences,...t.payload}}};case"SETTINGS_SET_FEATURE_FLAG":return{...e,settings:{...e.settings,featureFlags:{...e.settings.featureFlags,[t.payload.key]:t.payload.value}}};case"NAVIGATION_SET_ROUTE":return{...e,navigation:{...e.navigation,previousRoute:e.navigation.currentRoute,currentRoute:t.payload.route,params:t.payload.params||{},query:t.payload.query||{},history:[...e.navigation.history,{path:t.payload.route,timestamp:Date.now(),state:t.payload}].slice(-50)}};case"STATE_REHYDRATE":return{...e,...t.payload};case"STATE_RESET":return this.createInitialState();default:return e}}notifyListeners(){this.listeners.forEach(e=>{try{e(this.state)}catch(t){console.error("State listener error:",t)}})}subscribe(e){return this.listeners.add(e),()=>this.listeners.delete(e)}addMiddleware(e){this.middlewares.push(e),console.log(`Added middleware: ${e.name}`)}removeMiddleware(e){const t=this.middlewares.findIndex(r=>r.name===e);return t>=0?(this.middlewares.splice(t,1),console.log(`Removed middleware: ${e}`),!0):!1}configurePersistence(e){this.persistenceConfig=e,console.log("Persistence configured:",e)}async rehydrate(){const e=await this.loadPersistedState();e&&(this.dispatch({type:"STATE_REHYDRATE",payload:e}),console.log("State rehydrated from storage"))}getState(){return{...this.state}}getSlice(e){return this.state[e]}batch(e){this.dispatch({type:"STATE_BATCH",payload:e})}reset(){this.dispatch({type:"STATE_RESET"})}getActionHistory(){return[...this.actionHistory]}exportState(){return{state:this.state,actionHistory:this.actionHistory,middlewares:this.middlewares.map(e=>e.name),persistenceConfig:this.persistenceConfig,timestamp:Date.now()}}replayActions(e){if(!this.devMode){console.warn("Replay actions only available in development mode");return}const t=this.createInitialState();this.state=t,e.forEach(r=>{this.dispatch(r)}),console.log("Actions replayed")}};n(A,"instance");let q=A;const E=q.getInstance(),k=class k{constructor(){n(this,"config");n(this,"cache",new Map);n(this,"offlineQueue",[]);n(this,"metrics");n(this,"isOnline",navigator.onLine);n(this,"requestId",0);n(this,"activeRequests",new Map);n(this,"rateLimiters",new Map);this.config=this.createDefaultConfig(),this.metrics=this.createDefaultMetrics(),this.setupEventListeners(),this.setupDefaultInterceptors(),this.startBackgroundTasks()}static getInstance(){return k.instance||(k.instance=new k),k.instance}createDefaultConfig(){return{baseURL:"/api/v1",timeout:3e4,retryCount:3,retryDelay:1e3,enableCaching:!0,enableOffline:!0,enableMetrics:!0,defaultHeaders:{"Content-Type":"application/json",Accept:"application/json"},interceptors:{request:[],response:[]}}}createDefaultMetrics(){return{totalRequests:0,successfulRequests:0,failedRequests:0,cachedRequests:0,averageResponseTime:0,networkErrors:0,timeoutErrors:0,retryAttempts:0,offlineQueue:0,cacheHitRate:0,lastReset:Date.now()}}setupEventListeners(){window.addEventListener("online",()=>{console.log("Network back online, processing offline queue"),this.isOnline=!0,this.processOfflineQueue()}),window.addEventListener("offline",()=>{console.log("Network went offline"),this.isOnline=!1}),window.addEventListener("storage",e=>{var t;(t=e.key)!=null&&t.startsWith("api-cache-")&&this.handleCacheSync(e)}),document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&this.syncBackgroundCache()})}setupDefaultInterceptors(){this.addRequestInterceptor({name:"auth",onFulfilled:async e=>{const t=R.getAuthHeader();return t&&(e.headers={...e.headers,Authorization:t}),e}}),this.addResponseInterceptor({name:"retry",onRejected:async e=>{var s,a,i;const t=e.config,r=(t==null?void 0:t.retry)||{count:this.config.retryCount,delay:this.config.retryDelay,exponentialBackoff:!0,retryCondition:c=>c.isRetryable!==!1};if(this.shouldRetry(e,r))return await this.delay(this.calculateDelay(r,((a=(s=e.config)==null?void 0:s.metadata)==null?void 0:a.retryCount)||0)),this.request({...t,metadata:{...t==null?void 0:t.metadata,retryCount:(((i=t==null?void 0:t.metadata)==null?void 0:i.retryCount)||0)+1}});throw e}}),this.addResponseInterceptor({name:"errorLogging",onRejected:e=>{var t,r;throw w.handleError(e,{id:`api-error-${Date.now()}`,timestamp:Date.now(),sessionId:"api-layer",url:window.location.href,userAgent:navigator.userAgent,component:"APILayer",action:`${(t=e.config)==null?void 0:t.method} ${(r=e.config)==null?void 0:r.url}`,metadata:{config:e.config,response:e.response}}),e}})}startBackgroundTasks(){setInterval(()=>{this.cleanupCache()},5*60*1e3),setInterval(()=>{this.updateMetrics()},60*1e3),setInterval(()=>{this.isOnline&&this.offlineQueue.length>0&&this.processOfflineQueue()},30*1e3),setInterval(()=>{this.updateBackgroundCache()},2*60*1e3)}configure(e){this.config={...this.config,...e},console.log("API Layer configured:",this.config)}async request(e){var s,a,i;const t=Date.now(),r=(++this.requestId).toString();try{const c=this.normalizeConfig(e);if(await this.checkRateLimit(c),(s=c.cache)!=null&&s.enabled&&c.method==="GET"){const p=this.getFromCache(c);if(p)return this.metrics.cachedRequests++,p}if(!this.isOnline&&((a=c.offline)!=null&&a.enabled))return this.handleOfflineRequest(c);let d=c;for(const p of this.config.interceptors.request)p.onFulfilled&&(d=await p.onFulfilled(d));const o=await this.makeRequest(d,r);(i=d.cache)!=null&&i.enabled&&this.setCache(d,o);let g=o;for(const p of this.config.interceptors.response)p.onFulfilled&&(g=await p.onFulfilled(g));return this.metrics.totalRequests++,this.metrics.successfulRequests++,this.updateResponseTime(Date.now()-t),g}catch(c){this.metrics.totalRequests++,this.metrics.failedRequests++;let d=c;for(const o of this.config.interceptors.response)if(o.onRejected)try{d=await o.onRejected(d)}catch(g){d=g}throw d}finally{this.activeRequests.delete(r)}}async get(e,t){return this.request({...t,url:e,method:"GET"})}async post(e,t,r){return this.request({...r,url:e,method:"POST",data:t})}async put(e,t,r){return this.request({...r,url:e,method:"PUT",data:t})}async patch(e,t,r){return this.request({...r,url:e,method:"PATCH",data:t})}async delete(e,t){return this.request({...t,url:e,method:"DELETE"})}normalizeConfig(e){return{...e,url:this.buildURL(e.url,e.params),headers:{...this.config.defaultHeaders,...e.headers},timeout:e.timeout||this.config.timeout,cache:e.cache?{enabled:this.config.enableCaching,ttl:5*60*1e3,strategy:"cache-first",...e.cache}:void 0,retry:e.retry||{count:this.config.retryCount,delay:this.config.retryDelay,exponentialBackoff:!0,retryCondition:t=>t.isRetryable!==!1},offline:e.offline?{enabled:this.config.enableOffline,queueRequest:!0,notification:!0,...e.offline}:void 0}}buildURL(e,t){const r=e.startsWith("http")?e:`${this.config.baseURL}${e}`;if(!t)return r;const s=new URL(r,window.location.origin);return Object.entries(t).forEach(([a,i])=>{i!=null&&s.searchParams.append(a,String(i))}),s.toString()}async makeRequest(e,t){const r=new AbortController;this.activeRequests.set(t,r);const s=setTimeout(()=>{r.abort()},e.timeout);try{const a=await fetch(e.url,{method:e.method,headers:e.headers,body:e.data?JSON.stringify(e.data):void 0,signal:r.signal});if(clearTimeout(s),!a.ok)throw this.createAPIError(a,e);return{data:await this.parseResponse(a),status:a.status,statusText:a.statusText,headers:this.parseHeaders(a.headers),config:e}}catch(a){if(clearTimeout(s),a instanceof Error){if(a.name==="AbortError"){const i=this.createTimeoutError(e);throw this.metrics.timeoutErrors++,i}if(!navigator.onLine){const i=this.createNetworkError(e);throw this.metrics.networkErrors++,i}}throw a}}async parseResponse(e){const t=e.headers.get("content-type");return t!=null&&t.includes("application/json")?e.json():t!=null&&t.includes("text/")?e.text():t!=null&&t.includes("application/octet-stream")?e.blob():e.text()}parseHeaders(e){const t={};return e.forEach((r,s)=>{t[s]=r}),t}createAPIError(e,t){const r=new Error(`HTTP ${e.status}: ${e.statusText}`);return r.code=`HTTP_${e.status}`,r.status=e.status,r.statusText=e.statusText,r.config=t,r.isRetryable=this.isRetryableStatus(e.status),r}createTimeoutError(e){const t=new Error("Request timeout");return t.code="TIMEOUT",t.config=e,t.isTimeoutError=!0,t.isRetryable=!0,t}createNetworkError(e){const t=new Error("Network error");return t.code="NETWORK_ERROR",t.config=e,t.isNetworkError=!0,t.isRetryable=!0,t}isRetryableStatus(e){return e>=500||e===429||e===408}getCacheKey(e){var r;if((r=e.cache)!=null&&r.key)return e.cache.key;const t=e.params?JSON.stringify(e.params):"";return`${e.method}:${e.url}:${t}`}getFromCache(e){const t=this.getCacheKey(e),r=this.cache.get(t);return r?Date.now()>r.timestamp+r.ttl?(this.cache.delete(t),null):(r.hits++,r.lastAccess=Date.now(),{data:r.data,status:200,statusText:"OK",headers:{},config:e,cached:!0}):null}setCache(e,t){var c;if(!((c=e.cache)!=null&&c.enabled))return;const r=this.getCacheKey(e),a=JSON.stringify(t.data).length,i={key:r,data:t.data,timestamp:Date.now(),ttl:e.cache.ttl||5*60*1e3,tags:e.cache.tags||[],size:a,hits:0,lastAccess:Date.now()};this.cache.set(r,i),e.cache.strategy!=="cache-only"&&this.persistCache(r,i)}persistCache(e,t){try{localStorage.setItem(`api-cache-${e}`,JSON.stringify(t))}catch(r){console.warn("Failed to persist cache entry:",r)}}cleanupCache(){const e=Date.now(),t=[];this.cache.forEach((r,s)=>{e>r.timestamp+r.ttl&&t.push(s)}),t.forEach(r=>{this.cache.delete(r);try{localStorage.removeItem(`api-cache-${r}`)}catch(s){console.warn("Failed to remove cached item:",s)}}),console.log(`Cleaned up ${t.length} expired cache entries`)}async handleOfflineRequest(e){var t,r;if((t=e.offline)!=null&&t.fallbackData)return{data:e.offline.fallbackData,status:200,statusText:"OK (Offline)",headers:{},config:e,fromOffline:!0};throw(r=e.offline)!=null&&r.queueRequest&&(this.queueOfflineRequest(e),e.offline.notification&&E.dispatch({type:"UI_ADD_NOTIFICATION",payload:{id:`offline-${Date.now()}`,type:"warning",title:"Request Queued",message:"Request will be sent when connection is restored",createdAt:Date.now()}})),this.createNetworkError(e)}queueOfflineRequest(e){const t={id:`offline-${Date.now()}-${Math.random()}`,config:e,timestamp:Date.now(),attempts:0,priority:e.method==="GET"?1:2};this.offlineQueue.push(t),this.offlineQueue.sort((r,s)=>s.priority-r.priority),this.metrics.offlineQueue=this.offlineQueue.length}async processOfflineQueue(){if(!this.isOnline||this.offlineQueue.length===0)return;console.log(`Processing ${this.offlineQueue.length} offline requests`);const e=[...this.offlineQueue];this.offlineQueue=[];for(const t of e)try{await this.request(t.config),console.log(`Successfully processed offline request: ${t.config.method} ${t.config.url}`)}catch(r){console.error("Failed to process offline request:",r),t.attempts++,t.attempts<3&&this.offlineQueue.push(t)}this.metrics.offlineQueue=this.offlineQueue.length}async checkRateLimit(e){const t=`${e.method}:${e.url.split("?")[0]}`;let r=this.rateLimiters.get(t);r||(r=new re(100,6e4),this.rateLimiters.set(t,r)),await r.acquire()}shouldRetry(e,t){var s,a;return(((a=(s=e.config)==null?void 0:s.metadata)==null?void 0:a.retryCount)||0)>=t.count?!1:t.retryCondition(e)}calculateDelay(e,t){return e.exponentialBackoff?e.delay*Math.pow(2,t):e.delay}delay(e){return new Promise(t=>setTimeout(t,e))}addRequestInterceptor(e){this.config.interceptors.request.push(e),console.log(`Added request interceptor: ${e.name}`)}addResponseInterceptor(e){this.config.interceptors.response.push(e),console.log(`Added response interceptor: ${e.name}`)}removeRequestInterceptor(e){const t=this.config.interceptors.request.findIndex(r=>r.name===e);return t>=0?(this.config.interceptors.request.splice(t,1),!0):!1}removeResponseInterceptor(e){const t=this.config.interceptors.response.findIndex(r=>r.name===e);return t>=0?(this.config.interceptors.response.splice(t,1),!0):!1}invalidateCache(e){if(!e){this.cache.clear();return}const t=[];this.cache.forEach((r,s)=>{(e instanceof RegExp?e.test(s):s.includes(e))&&t.push(s)}),t.forEach(r=>this.cache.delete(r)),console.log(`Invalidated ${t.length} cache entries`)}invalidateCacheByTags(e){const t=[];this.cache.forEach((r,s)=>{e.some(i=>r.tags.includes(i))&&t.push(s)}),t.forEach(r=>this.cache.delete(r)),console.log(`Invalidated ${t.length} cache entries by tags:`,e)}updateBackgroundCache(){this.cache.forEach(async(e,t)=>{if(e.hits>5&&Date.now()-e.lastAccess<10*60*1e3&&e.timestamp+e.ttl-Date.now()<e.ttl*.2)try{const s=JSON.parse(localStorage.getItem(`api-config-${t}`)||"{}");s.url&&this.request(s).catch(()=>{})}catch(s){console.warn("Background cache update failed:",s)}})}syncBackgroundCache(){try{for(let e=0;e<localStorage.length;e++){const t=localStorage.key(e);if(t!=null&&t.startsWith("api-cache-")){const r=t.replace("api-cache-","");if(!this.cache.has(r)){const s=JSON.parse(localStorage.getItem(t)||"{}");this.cache.set(r,s)}}}}catch(e){console.warn("Cache sync failed:",e)}}handleCacheSync(e){if(!e.key||!e.key.startsWith("api-cache-"))return;const t=e.key.replace("api-cache-","");if(e.newValue)try{const r=JSON.parse(e.newValue);this.cache.set(t,r)}catch(r){console.warn("Failed to sync cache entry:",r)}else this.cache.delete(t)}updateMetrics(){this.cache.size;const e=this.metrics.cachedRequests,t=this.metrics.totalRequests;this.metrics.cacheHitRate=t>0?e/t:0}updateResponseTime(e){const t=this.metrics.averageResponseTime,r=this.metrics.totalRequests;this.metrics.averageResponseTime=r>1?(t*(r-1)+e)/r:e}getMetrics(){return{...this.metrics}}resetMetrics(){this.metrics=this.createDefaultMetrics(),console.log("API metrics reset")}cancelRequest(e){const t=this.activeRequests.get(e);return t?(t.abort(),this.activeRequests.delete(e),!0):!1}cancelAllRequests(){this.activeRequests.forEach(e=>{e.abort()}),this.activeRequests.clear(),console.log("All active requests cancelled")}exportState(){return{config:this.config,metrics:this.metrics,cacheSize:this.cache.size,offlineQueueSize:this.offlineQueue.length,activeRequestsCount:this.activeRequests.size,isOnline:this.isOnline,timestamp:Date.now()}}getCacheStats(){const e={totalEntries:this.cache.size,totalSize:0,averageHits:0,oldestEntry:0,newestEntry:0};return this.cache.forEach(t=>{e.totalSize+=t.size,e.averageHits+=t.hits,(!e.oldestEntry||t.timestamp<e.oldestEntry)&&(e.oldestEntry=t.timestamp),(!e.newestEntry||t.timestamp>e.newestEntry)&&(e.newestEntry=t.timestamp)}),e.totalEntries>0&&(e.averageHits/=e.totalEntries),e}};n(k,"instance");let L=k;class re{constructor(e,t){n(this,"tokens");n(this,"maxTokens");n(this,"refillRate");n(this,"lastRefill");n(this,"queue",[]);this.maxTokens=e,this.tokens=e,this.refillRate=e/t,this.lastRefill=Date.now()}async acquire(){return this.refill(),this.tokens>=1?(this.tokens--,Promise.resolve()):new Promise(e=>{this.queue.push({resolve:e,timestamp:Date.now()}),this.processQueue()})}refill(){const e=Date.now(),r=(e-this.lastRefill)*this.refillRate;this.tokens=Math.min(this.maxTokens,this.tokens+r),this.lastRefill=e}processQueue(){if(this.queue.length===0)return;for(this.refill();this.queue.length>0&&this.tokens>=1;){const t=this.queue.shift();t&&(this.tokens--,t.resolve())}const e=Date.now();this.queue=this.queue.filter(t=>e-t.timestamp<6e4)}}const O=L.getInstance(),I=class I{constructor(){n(this,"routes",[]);n(this,"routeMap",new Map);n(this,"guards",new Map);n(this,"hooks",[]);n(this,"preloadStrategies",[]);n(this,"navigationState");n(this,"preloadQueue",new Set);n(this,"loadingPromises",new Map);n(this,"transitions",new Map);n(this,"breadcrumbCache",new Map);this.navigationState={current:null,previous:null,history:[],isNavigating:!1,loadingRoute:null,error:null,preloadedRoutes:new Set,cachedComponents:new Map},this.setupDefaultGuards(),this.setupDefaultPreloadStrategies(),this.setupEventListeners()}static getInstance(){return I.instance||(I.instance=new I),I.instance}setupDefaultGuards(){this.addGuard({name:"auth",priority:1e3,guard:async e=>e.meta.requiresAuth&&!R.isAuthenticated()?"/login":!0}),this.addGuard({name:"role",priority:900,guard:async e=>{if(e.meta.roles&&e.meta.roles.length>0){const t=R.getCurrentUser();if(!t||!e.meta.roles.includes(t.role))return"/403"}return!0}}),this.addGuard({name:"permission",priority:800,guard:async e=>{if(e.meta.permissions&&e.meta.permissions.length>0){const t=R.getCurrentUser();if(!t||!this.hasPermissions(t,e.meta.permissions))return"/403"}return!0}})}setupDefaultPreloadStrategies(){this.addPreloadStrategy({name:"high-priority",priority:1e3,shouldPreload:e=>{var t;return((t=e.meta)==null?void 0:t.priority)===1||e.path==="/dashboard"}}),this.addPreloadStrategy({name:"interaction",priority:800,shouldPreload:(e,t)=>{var r;return t.userInteraction&&((r=e.meta)==null?void 0:r.preload)!==!1}}),this.addPreloadStrategy({name:"connection-aware",priority:600,shouldPreload:(e,t)=>{var s,a;const r=navigator.connection;return r?r.effectiveType==="4g"&&!r.saveData?((s=e.meta)==null?void 0:s.preload)!==!1:((a=e.meta)==null?void 0:a.preload)===!0:!0}})}setupEventListeners(){window.addEventListener("popstate",e=>{this.handlePopState(e)}),document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"?this.resumePreloading():this.pausePreloading()}),window.addEventListener("online",()=>{this.resumePreloading()}),window.addEventListener("offline",()=>{this.pausePreloading()})}addRoute(e){this.routes.push(e),this.buildRouteMap(e),console.log(`Route added: ${e.path} -> ${e.name}`)}addRoutes(e){e.forEach(t=>this.addRoute(t))}buildRouteMap(e,t=""){const r=this.normalizePath(t+e.path);this.routeMap.set(e.name,{...e,path:r}),e.children&&e.children.forEach(s=>{this.buildRouteMap(s,r)})}normalizePath(e){return e.replace(/\/+/g,"/").replace(/\/$/,"")||"/"}addGuard(e){this.guards.set(e.name,e),console.log(`Route guard added: ${e.name}`)}removeGuard(e){return this.guards.delete(e)}addHook(e){this.hooks.push(e),console.log(`Navigation hook added: ${e.name}`)}removeHook(e){this.hooks=this.hooks.filter(t=>t.name!==e)}addPreloadStrategy(e){this.preloadStrategies.push(e),this.preloadStrategies.sort((t,r)=>r.priority-t.priority),console.log(`Preload strategy added: ${e.name}`)}async navigate(e,t){try{this.navigationState.isNavigating=!0,this.navigationState.error=null;const r=typeof e=="string"?await this.resolve(e):e;if(!r)throw new Error(`Route not found: ${typeof e=="string"?e:e.path}`);await this.runBeforeEachHooks(r,this.navigationState.current);const s=await this.runGuards(r,this.navigationState.current);return s!==!0?typeof s=="string"?this.navigate(s):!1:(await this.loadRouteComponent(r),await this.runBeforeResolveHooks(r),this.updateNavigationState(r),t!=null&&t.replace?window.history.replaceState({route:r},r.meta.title||"",r.fullPath):window.history.pushState({route:r},r.meta.title||"",r.fullPath),this.updateDocumentMeta(r),await this.runAfterEachHooks(r,this.navigationState.previous),this.triggerPreloading(r),E.dispatch({type:"NAVIGATION_UPDATE",payload:{current:r,previous:this.navigationState.previous,timestamp:Date.now()}}),!0)}catch(r){const s={type:"loading",message:r instanceof Error?r.message:"Navigation failed",route:typeof e=="string"?e:e.path,originalError:r instanceof Error?r:void 0};return this.navigationState.error=s,await this.runErrorHooks(s),w.handleError(r,{id:`navigation-error-${Date.now()}`,timestamp:Date.now(),sessionId:"routing",url:window.location.href,userAgent:navigator.userAgent,component:"AdvancedRoutingSystem",action:"navigate",metadata:{to:e,options:t}}),!1}finally{this.navigationState.isNavigating=!1,this.navigationState.loadingRoute=null}}async resolve(e){const t=new URL(e,window.location.origin),r=t.pathname,s=Object.fromEntries(t.searchParams),a=t.hash;for(const i of this.routes){const c=this.matchRoute(i,r);if(c)return{path:r,fullPath:e,name:i.name,params:c.params,query:s,hash:a,meta:i.meta||{},matched:c.matched}}return null}matchRoute(e,t,r=[]){const s=e.path,a=t.split("/").filter(Boolean),i=s.split("/").filter(Boolean);if(a.length!==i.length&&!e.children)return null;const c={},d=[...r,e];for(let o=0;o<i.length;o++){const g=i[o],p=a[o];if(g.startsWith(":")){const D=g.slice(1);c[D]=p}else if(g!==p)return null}if(e.children&&a.length>i.length){const o="/"+a.slice(i.length).join("/");for(const g of e.children){const p=this.matchRoute(g,o,d);if(p)return{params:{...c,...p.params},matched:p.matched}}}return{params:c,matched:d}}async loadRouteComponent(e){const t=this.routeMap.get(e.name);if(t&&!t.component&&t.lazy){this.navigationState.loadingRoute=e.name;try{let r=this.loadingPromises.get(e.name);r||(r=t.lazy(),this.loadingPromises.set(e.name,r));const s=await r;t.component=s.default,this.navigationState.cachedComponents.set(e.name,s.default),console.log(`Component loaded: ${e.name}`)}catch(r){throw console.error(`Failed to load component for route ${e.name}:`,r),r}}}async preloadRoute(e){if(this.navigationState.preloadedRoutes.has(e)||this.loadingPromises.has(e))return;const t=this.routeMap.get(e);if(!(!t||!t.lazy))try{const r=t.lazy();this.loadingPromises.set(e,r);const s=await r;t.component=s.default,this.navigationState.cachedComponents.set(e,s.default),this.navigationState.preloadedRoutes.add(e),console.log(`Route preloaded: ${e}`)}catch(r){console.warn(`Failed to preload route ${e}:`,r)}}triggerPreloading(e){var r;const t={currentRoute:e,userInteraction:!0,connectionType:((r=navigator.connection)==null?void 0:r.effectiveType)||"4g",memoryInfo:performance.memory,timing:performance.timing};for(const[s,a]of this.routeMap)this.shouldPreloadRoute(a,t)&&this.preloadQueue.add(s);this.processPreloadQueue()}shouldPreloadRoute(e,t){return this.preloadStrategies.some(r=>r.shouldPreload(e,t))}async processPreloadQueue(){const e=Array.from(this.preloadQueue).slice(0,3);e.forEach(t=>this.preloadQueue.delete(t)),await Promise.all(e.map(t=>this.preloadRoute(t).catch(()=>{}))),this.preloadQueue.size>0&&setTimeout(()=>this.processPreloadQueue(),1e3)}pausePreloading(){this.preloadQueue.clear()}resumePreloading(){this.navigationState.current&&this.triggerPreloading(this.navigationState.current)}async runGuards(e,t){const r=Array.from(this.guards.values()).sort((s,a)=>(a.priority||0)-(s.priority||0));for(const s of r)try{const a=await s.guard(e,t);if(a!==!0)return console.log(`Guard ${s.name} blocked navigation to ${e.path}`),a}catch(a){return console.error(`Guard ${s.name} threw error:`,a),!1}return!0}async runBeforeEachHooks(e,t){for(const r of this.hooks)if(r.beforeEach)try{await r.beforeEach(e,t)}catch(s){console.error(`Hook ${r.name} beforeEach error:`,s)}}async runAfterEachHooks(e,t){for(const r of this.hooks)if(r.afterEach)try{await r.afterEach(e,t)}catch(s){console.error(`Hook ${r.name} afterEach error:`,s)}}async runBeforeResolveHooks(e){for(const t of this.hooks)if(t.beforeResolve)try{await t.beforeResolve(e)}catch(r){console.error(`Hook ${t.name} beforeResolve error:`,r)}}async runErrorHooks(e){for(const t of this.hooks)if(t.onError)try{await t.onError(e)}catch(r){console.error(`Hook ${t.name} onError error:`,r)}}updateNavigationState(e){this.navigationState.previous=this.navigationState.current,this.navigationState.current=e,this.navigationState.previous&&(this.navigationState.history.push(this.navigationState.previous),this.navigationState.history.length>50&&(this.navigationState.history=this.navigationState.history.slice(-25)))}updateDocumentMeta(e){var t;e.meta.title&&(document.title=e.meta.title),this.updateMetaTag("description",e.meta.description),this.updateMetaTag("keywords",(t=e.meta.keywords)==null?void 0:t.join(", "))}updateMetaTag(e,t){if(!t)return;let r=document.querySelector(`meta[name="${e}"]`);r||(r=document.createElement("meta"),r.name=e,document.head.appendChild(r)),r.content=t}generateBreadcrumbs(e){var a,i;const t=e||this.navigationState.current;if(!t)return[];const r=t.fullPath;if(this.breadcrumbCache.has(r))return this.breadcrumbCache.get(r);const s=[];for(const c of t.matched)((a=c.meta)==null?void 0:a.breadcrumb)!==!1&&s.push({name:c.name,path:c.path,title:((i=c.meta)==null?void 0:i.title)||c.name,meta:c.meta||{},params:t.params});return this.breadcrumbCache.set(r,s),s}handlePopState(e){const t=e.state;t&&t.route?this.navigate(t.route,{replace:!0}):this.navigate(window.location.pathname+window.location.search+window.location.hash,{replace:!0})}hasPermissions(e,t){return!e.permissions||!Array.isArray(e.permissions)?!1:t.every(r=>e.permissions.includes(r))}getCurrentRoute(){return this.navigationState.current}getPreviousRoute(){return this.navigationState.previous}getNavigationHistory(){return[...this.navigationState.history]}isNavigating(){return this.navigationState.isNavigating}getNavigationError(){return this.navigationState.error}getPreloadedRoutes(){return Array.from(this.navigationState.preloadedRoutes)}getCachedComponents(){return Array.from(this.navigationState.cachedComponents.keys())}async push(e){return this.navigate(e,{replace:!1})}async replace(e){return this.navigate(e,{replace:!0})}async back(){window.history.back()}async forward(){window.history.forward()}async go(e){window.history.go(e)}exportState(){return{routes:this.routes.length,routeMap:Array.from(this.routeMap.keys()),guards:Array.from(this.guards.keys()),hooks:this.hooks.map(e=>e.name),preloadStrategies:this.preloadStrategies.map(e=>e.name),navigationState:{...this.navigationState,preloadedRoutes:Array.from(this.navigationState.preloadedRoutes),cachedComponents:Array.from(this.navigationState.cachedComponents.keys())},preloadQueue:Array.from(this.preloadQueue),loadingPromises:Array.from(this.loadingPromises.keys()),breadcrumbCache:Array.from(this.breadcrumbCache.keys()),timestamp:Date.now()}}getRouteAnalytics(){const e=this.navigationState.history,t=new Map;return e.forEach(r=>{t.set(r.name,(t.get(r.name)||0)+1)}),{totalNavigations:e.length,uniqueRoutes:t.size,mostVisited:Array.from(t.entries()).sort((r,s)=>s[1]-r[1]).slice(0,10),preloadEfficiency:{preloaded:this.navigationState.preloadedRoutes.size,cached:this.navigationState.cachedComponents.size,hitRate:this.calculatePreloadHitRate()}}}calculatePreloadHitRate(){const e=this.navigationState.history.length;return e===0?0:this.navigationState.history.filter(r=>this.navigationState.preloadedRoutes.has(r.name)).length/e*100}};n(I,"instance");let H=I;const f=H.getInstance(),X=()=>{const[m,e]=y.useState(f.getCurrentRoute()),[t,r]=y.useState(f.getPreviousRoute()),[s,a]=y.useState(f.isNavigating()),[i,c]=y.useState(f.getNavigationError());y.useEffect(()=>{const N=setInterval(()=>{e(f.getCurrentRoute()),r(f.getPreviousRoute()),a(f.isNavigating()),c(f.getNavigationError())},100);return()=>{clearInterval(N)}},[]);const d=y.useCallback(async(v,N=!1)=>f.navigate(v,{replace:N}),[]),o=y.useCallback(v=>f.push(v),[]),g=y.useCallback(v=>f.replace(v),[]),p=y.useCallback(()=>f.back(),[]),D=y.useCallback(()=>f.forward(),[]),x=y.useCallback(v=>f.go(v),[]);return{currentRoute:m,previousRoute:t,isNavigating:s,navigationError:i,navigate:d,push:o,replace:g,back:p,forward:D,go:x}},se=()=>{const{currentRoute:m}=X(),[e,t]=y.useState([]);return y.useEffect(()=>{if(m){const r=f.generateBreadcrumbs(m);t(r)}},[m]),e},ae=()=>{const[m,e]=y.useState(f.getRouteAnalytics());return y.useEffect(()=>{const r=setInterval(()=>{e(f.getRouteAnalytics())},5e3);return()=>clearInterval(r)},[]),m},le=()=>{var N,_,U,z,B,G,F,j,K,Q,J,Y,V,W;const[m,e]=y.useState({}),[t,r]=y.useState([]),{currentRoute:s,isNavigating:a,navigate:i}=X(),c=se(),d=ae(),o=h=>{r(S=>[...S,`${new Date().toLocaleTimeString()}: ${h}`])},g=async()=>{try{o("ðŸš€ Starting system tests...");try{const h=w.getSystemStatus();o(`âœ… Error Recovery System: ${h.isHealthy?"Healthy":"Issues detected"}`)}catch(h){o(`âŒ Error Recovery System: ${h}`)}try{const h=E.getState();o(`âœ… State Management: Initialized with ${Object.keys(h).length} modules`),E.dispatch({type:"UI_ADD_NOTIFICATION",payload:{id:"test-notification",type:"info",title:"System Test",message:"State management is working!",createdAt:Date.now()}}),o("âœ… State dispatch: Notification added successfully")}catch(h){o(`âŒ State Management: ${h}`)}try{const h=R.isAuthenticated();o(`âœ… Auth System: Status = ${h?"Authenticated":"Not authenticated"}`);const S=R.getCurrentUser();o(`âœ… Auth Profile: ${S?"User loaded":"No user"}`)}catch(h){o(`âŒ Auth System: ${h}`)}try{const h=O.getMetrics();o(`âœ… API Layer: ${h.totalRequests} total requests processed`);const S=O.exportState();o(`âœ… API Status: ${S.isOnline?"Online":"Offline"}, Cache size: ${S.cacheSize}`)}catch(h){o(`âŒ API Layer: ${h}`)}o("ðŸŽ‰ All system tests completed!")}catch(h){o(`ðŸ’¥ Test suite failed: ${h}`)}},p=async()=>{try{o("ðŸŒ Testing API call...");const h=await O.get("/test",{cache:{enabled:!0,ttl:6e4},offline:{enabled:!0,fallbackData:{message:"Offline fallback data"}}});o(`âœ… API Call successful: ${JSON.stringify(h.data).substring(0,100)}...`)}catch(h){o(`âš ï¸ API Call failed (expected): ${h.message}`)}},D=async()=>{try{o("ðŸ”¥ Testing error handling...");const h=new Error("Simulated test error");w.handleError(h,{id:"demo-error-"+Date.now(),timestamp:Date.now(),sessionId:"demo-session",url:window.location.href,userAgent:navigator.userAgent,component:"DemoPage",action:"testErrorHandling",metadata:{testType:"simulation"}}),o("âœ… Error handled and logged successfully")}catch(h){o(`âŒ Error handling failed: ${h}`)}},x=async()=>{try{o("ðŸ“Š Testing state management..."),E.dispatch({type:"UI_SET_THEME",payload:{theme:"dark"}}),E.dispatch({type:"UI_SET_LOADING",payload:{isLoading:!0,message:"Processing demo..."}}),setTimeout(()=>{E.dispatch({type:"UI_SET_LOADING",payload:{isLoading:!1,message:""}})},2e3),o("âœ… State updates dispatched successfully")}catch(h){o(`âŒ State management test failed: ${h}`)}},v=async()=>{try{o("ðŸ§­ Testing routing system...");const h={path:"/dashboard",name:"dashboard",meta:{title:"Dashboard",requiresAuth:!0,preload:!0,priority:1}},S={path:"/customers",name:"customers",meta:{title:"Customers",requiresAuth:!0}};f.addRoute(h),f.addRoute(S),o("âœ… Routes configured: 2 routes added");const C=await f.navigate("/dashboard");o(`âœ… Navigation ${C?"succeeded":"failed"}: /dashboard`);const P=await f.resolve("/dashboard");o(P?`âœ… Route resolved: ${P.name} (${P.path})`:"âŒ Route resolution failed");const Z=c.length;o(`âœ… Breadcrumbs generated: ${Z} items`),o(`âœ… Route analytics: ${(d==null?void 0:d.totalNavigations)||0} navigations recorded`),o("âœ… Routing system tests completed!")}catch(h){o(`âŒ Routing system test failed: ${h}`)}};return y.useEffect(()=>{const h=()=>{var C;e({errorRecovery:{healthy:w.getSystemStatus().isHealthy,errors:w.getSystemStatus().errorCount},auth:{authenticated:R.isAuthenticated(),user:((C=R.getCurrentUser())==null?void 0:C.email)||"None"},api:{online:navigator.onLine,metrics:O.getMetrics()},state:{modules:Object.keys(E.getState()).length,initialized:!0},routing:{currentRoute:(s==null?void 0:s.name)||"none",isNavigating:a,totalRoutes:f.exportState().routes,analytics:d}})};h();const S=setInterval(h,5e3);return()=>clearInterval(S)},[]),u("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-8",children:l("div",{className:"max-w-6xl mx-auto",children:[l("div",{className:"text-center mb-8",children:[u("h1",{className:"text-4xl font-bold text-gray-900 mb-4",children:"ðŸš€ SaleBDS Advanced Systems Demo"}),u("p",{className:"text-lg text-gray-600",children:"Testing Error Recovery, Authentication, State Management, and API Layer"})]}),l("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6 mb-8",children:[l("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[u("h3",{className:"text-lg font-semibold mb-4 text-red-600",children:"ðŸ›¡ï¸ Error Recovery"}),l("div",{className:"space-y-2",children:[l("p",{className:"text-sm",children:["Status: ",u("span",{className:(N=m.errorRecovery)!=null&&N.healthy?"text-green-600":"text-red-600",children:(_=m.errorRecovery)!=null&&_.healthy?"Healthy":"Issues"})]}),l("p",{className:"text-sm",children:["Errors: ",((U=m.errorRecovery)==null?void 0:U.errors)||0]})]})]}),l("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[u("h3",{className:"text-lg font-semibold mb-4 text-blue-600",children:"ðŸ” Authentication"}),l("div",{className:"space-y-2",children:[l("p",{className:"text-sm",children:["Status: ",u("span",{className:(z=m.auth)!=null&&z.authenticated?"text-green-600":"text-yellow-600",children:(B=m.auth)!=null&&B.authenticated?"Authenticated":"Guest"})]}),l("p",{className:"text-sm",children:["User: ",((G=m.auth)==null?void 0:G.user)||"None"]})]})]}),l("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[u("h3",{className:"text-lg font-semibold mb-4 text-green-600",children:"ðŸ“Š State Management"}),l("div",{className:"space-y-2",children:[l("p",{className:"text-sm",children:["Status: ",u("span",{className:"text-green-600",children:(F=m.state)!=null&&F.initialized?"Active":"Inactive"})]}),l("p",{className:"text-sm",children:["Modules: ",((j=m.state)==null?void 0:j.modules)||0]})]})]}),l("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[u("h3",{className:"text-lg font-semibold mb-4 text-purple-600",children:"ðŸŒ API Layer"}),l("div",{className:"space-y-2",children:[l("p",{className:"text-sm",children:["Network: ",u("span",{className:(K=m.api)!=null&&K.online?"text-green-600":"text-red-600",children:(Q=m.api)!=null&&Q.online?"Online":"Offline"})]}),l("p",{className:"text-sm",children:["Requests: ",((Y=(J=m.api)==null?void 0:J.metrics)==null?void 0:Y.totalRequests)||0]})]})]}),l("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[u("h3",{className:"text-lg font-semibold mb-4 text-indigo-600",children:"ðŸ§­ Routing System"}),l("div",{className:"space-y-2",children:[l("p",{className:"text-sm",children:["Status: ",u("span",{className:a?"text-yellow-600":"text-green-600",children:a?"Navigating":"Ready"})]}),l("p",{className:"text-sm",children:["Routes: ",((V=m.routing)==null?void 0:V.totalRoutes)||0]})]})]})]}),l("div",{className:"bg-white rounded-lg shadow-lg p-6 mb-8",children:[u("h2",{className:"text-2xl font-bold mb-6",children:"ðŸ§ª System Tests"}),l("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[u("button",{onClick:g,className:"bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg transition-colors",children:"ðŸ” Run All Tests"}),u("button",{onClick:p,className:"bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-lg transition-colors",children:"ðŸŒ Test API"}),u("button",{onClick:D,className:"bg-red-600 hover:bg-red-700 text-white font-medium py-2 px-4 rounded-lg transition-colors",children:"ðŸ”¥ Test Errors"}),u("button",{onClick:x,className:"bg-purple-600 hover:bg-purple-700 text-white font-medium py-2 px-4 rounded-lg transition-colors",children:"ðŸ“Š Test State"}),u("button",{onClick:v,className:"bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-2 px-4 rounded-lg transition-colors",children:"ðŸ§­ Test Routing"})]})]}),l("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[l("div",{className:"flex justify-between items-center mb-6",children:[u("h2",{className:"text-2xl font-bold",children:"ðŸ“‹ Test Results"}),u("button",{onClick:()=>r([]),className:"bg-gray-500 hover:bg-gray-600 text-white font-medium py-1 px-3 rounded transition-colors",children:"Clear"})]}),u("div",{className:"bg-gray-900 text-green-400 p-4 rounded-lg font-mono text-sm h-96 overflow-y-auto",children:t.length===0?u("p",{className:"text-gray-500",children:"No tests run yet. Click a test button to start!"}):t.map((h,S)=>u("div",{className:"mb-1",children:h},S))})]}),l("div",{className:"mt-8 bg-white rounded-lg shadow-lg p-6",children:[u("h2",{className:"text-2xl font-bold mb-6",children:"ðŸ”§ System Information"}),l("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[l("div",{children:[u("h3",{className:"text-lg font-semibold mb-3",children:"Environment"}),l("div",{className:"space-y-1 text-sm",children:[l("p",{children:[u("strong",{children:"URL:"})," ",window.location.href]}),l("p",{children:[u("strong",{children:"User Agent:"})," ",navigator.userAgent.substring(0,50),"..."]}),l("p",{children:[u("strong",{children:"Language:"})," ",navigator.language]}),l("p",{children:[u("strong",{children:"Online:"})," ",navigator.onLine?"Yes":"No"]})]})]}),l("div",{children:[u("h3",{className:"text-lg font-semibold mb-3",children:"Performance"}),l("div",{className:"space-y-1 text-sm",children:[l("p",{children:[u("strong",{children:"Memory:"})," ",performance.memory?`${Math.round(performance.memory.usedJSHeapSize/1024/1024)}MB`:"N/A"]}),l("p",{children:[u("strong",{children:"Connection:"})," ",((W=navigator.connection)==null?void 0:W.effectiveType)||"Unknown"]}),l("p",{children:[u("strong",{children:"Storage:"})," ",localStorage.length," items"]}),l("p",{children:[u("strong",{children:"Session:"})," ",sessionStorage.length," items"]})]})]})]})]})]})})};export{le as default};
